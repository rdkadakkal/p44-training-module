<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project44 Product Training Module</title>
    <!-- jsPDF Library for Certificate Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            /* Project44 Inspired Palette */
            --p44-navy: #1F2A44;      /* Deep Navy */
            --p44-blue: #00C0F3;      /* Cyan/Teal Accent */
            --text-color: #333333;
            --bg-color: #f4f7f6;
            --white: #ffffff;
            --success-green: #28a745;
            --error-red: #dc3545;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        header {
            background-color: var(--p44-navy);
            color: var(--white);
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        header h1 {
            font-weight: 600;
            letter-spacing: 0.5px;
            font-size: 1.5rem;
        }

        /* --- Main Container --- */
        .container {
            max-width: 800px;
            width: 95%;
            margin: 2rem auto;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(31, 42, 68, 0.1);
            padding: 2rem;
            flex: 1;
        }

        /* --- Video Section (Iframe Embed) --- */
        .video-section {
            display: block; /* Visible by default */
        }

        /* 16:9 Aspect Ratio Container for Iframe */
        .iframe-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .instruction-text {
            text-align: center;
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        /* --- Buttons --- */
        .btn {
            background-color: var(--p44-blue);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s ease;
            display: block;
            margin: 0 auto;
        }

        .btn:hover {
            background-color: #009ac2;
        }

        /* --- Quiz Section --- */
        .quiz-section {
            display: none; /* Hidden by default */
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--p44-navy);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--p44-navy);
            margin-bottom: 1.5rem;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background-color: var(--white);
            border: 2px solid #e0e0e0;
            padding: 15px;
            text-align: left;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease;
            color: var(--text-color);
        }

        .option-btn:hover {
            border-color: var(--p44-blue);
            background-color: #f0fbff;
        }

        /* --- Result Section --- */
        .result-section {
            display: none;
            text-align: center;
            padding: 1rem;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--p44-navy);
            margin-bottom: 1rem;
        }

        .result-message {
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }

        .hidden {
            display: none !important;
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
                margin: 1rem auto;
            }
            header h1 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Logistics & Visibility Fundamentals</h1>
    </header>

    <div class="container">
        
        <!-- SECTION 1: VIDEO PLAYER -->
        <div id="video-section" class="video-section">
            <h2 style="color: var(--p44-navy); margin-bottom: 1rem;">Step 1: Training Video</h2>
            
            <div class="iframe-container">
                <!-- Iframe src injected by JS -->
                <iframe id="google-drive-embed" allow="autoplay; fullscreen" allowfullscreen></iframe>
            </div>

            <p class="instruction-text">
                Please watch the video above. <br>
                <strong>Note:</strong> Since this is a Google Drive embed, we cannot automatically detect when it finishes.
            </p>

            <button class="btn" onclick="finishVideo()">I have finished watching the video</button>
        </div>

        <!-- SECTION 2: QUIZ -->
        <div id="quiz-section" class="quiz-section">
            <div class="progress-bar-container">
                <div id="progress-fill" class="progress-bar-fill"></div>
            </div>
            
            <div id="quiz-container">
                <div id="question-text" class="question-text"></div>
                <div id="options-container" class="options-list"></div>
            </div>
        </div>

        <!-- SECTION 3: RESULTS & CERTIFICATE -->
        <div id="result-section" class="result-section">
            <div id="score-text" class="score-display">0%</div>
            <h2 id="result-header" style="color: var(--p44-navy);">Completed</h2>
            <p id="result-detail" class="result-message"></p>

            <!-- SUCCESS / CERTIFICATE AREA (UPDATED) -->
            <div id="success-area" class="hidden" style="margin-top: 2rem; padding: 20px; background-color: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                <h3 style="color: #1F2A44; margin-bottom: 1rem;">Course Passed!</h3>
                <p style="margin-bottom: 1.5rem;">Please enter your name below to generate your official certificate.</p>
                
                <div style="max-width: 400px; margin: 0 auto;">
                    <label for="learner-name" style="display: block; text-align: left; font-weight: bold; color: #1F2A44; margin-bottom: 5px;">Full Name:</label>
                    <input type="text" id="learner-name" placeholder="Ex: Jane Doe" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-bottom: 15px; font-size: 16px;">
                    
                    <button onclick="generateCertificate()" style="background-color: #00C0F3; color: white; border: none; padding: 12px 24px; font-size: 16px; font-weight: bold; border-radius: 4px; cursor: pointer; width: 100%; transition: background 0.3s;">
                        Download Certificate
                    </button>
                </div>
            </div>

            <!-- Retry Area -->
            <div id="retry-area" class="hidden">
                <button class="btn" style="background-color: var(--p44-navy);" onclick="location.reload()">Retry Module</button>
            </div>
        </div>

    </div>

    <script>
        /**
         * ------------------------------------------------------------------
         * CONFIGURATION
         * ------------------------------------------------------------------
         */
        const videoID = "1kZ1uNSwoQ7_ha4n27RIOwVUSGB5iOblA";

        const quizData = [ 
            { "Question": "According to the sources, what is the legal role of a Freight Forwarder (FFW) in its purest definition?", "Options": [ "Carrier", "Agent", "Vessel Operator", "Consignee" ], "CorrectAnswer": 1 }, 
            { "Question": "Which primary document does an NVOCC issue to the actual shipper to act as a binding contract of carriage?", "Options": [ "Forwarder's Certificate of Receipt (FCR)", "Master Bill of Lading (MBL)", "House Bill of Lading (HBL)", "Shipper's Letter of Instruction (SLI)" ], "CorrectAnswer": 2 }, 
            { "Question": "What type of liability is typically associated with a Freight Forwarder acting as an agent?", "Options": [ "Full Carrier Liability", "Limited Agency Liability (Errors & Omissions)", "Strict Liability for Cargo Damage", "No Liability" ], "CorrectAnswer": 1 }, 
            { "Question": "Which EDI message code is known as the 'heartbeat' of ocean visibility, providing granular status details for major milestones?", "Options": [ "EDI 300", "EDI 301", "EDI 304", "EDI 315" ], "CorrectAnswer": 3 }, 
            { "Question": "Under the US Customs '10+2' rule, when must the Importer Security Filing (ISF) be submitted?", "Options": [ "24 hours after the vessel departs", "24 hours prior to loading at the foreign port", "Upon arrival at the destination port", "48 hours after the container gates in" ], "CorrectAnswer": 1 }, 
            { "Question": "In the context of LCL consolidation, what must an NVOCC provide to link individual HBLs to a single container number in visibility platforms?", "Options": [ "Master Bill of Lading", "Vessel Schedule (EDI 323)", "Container Manifest or Stuffing Report", "Freight Invoice (EDI 310)" ], "CorrectAnswer": 2 }, 
            { "Question": "What is a 'Street Turn' in physical logistics?", "Options": [ "A trucker reusing an empty container for a new export without returning it to the terminal", "A vessel changing course due to weather", "Returning a full container to the wrong terminal gate", "The process of weighing a container on a weighbridge" ], "CorrectAnswer": 0 }, 
            { "Question": "Which EDI 315 segment contains the specific event code, date, and time (e.g., VD for Vessel Departure)?", "Options": [ "B4", "N9", "Q2", "R4" ], "CorrectAnswer": 0 }, 
            { "Question": "What are the two data elements that the carrier must file under the US Customs '10+2' rule?", "Options": [ "Seller Name and Buyer Name", "Container Status Messages and Stow Plan", "Country of Origin and HTS-6 Code", "Manufacturer and Ship to Party" ], "CorrectAnswer": 1 }, 
            { "Question": "Which status code in the B4 segment of an EDI 315 message signifies that a container has been loaded on a vessel?", "Options": [ "OA", "VA", "AE", "UV" ], "CorrectAnswer": 2 } 
        ];

        /**
         * ------------------------------------------------------------------
         * APP LOGIC
         * ------------------------------------------------------------------
         */
        
        let currentQuestionIndex = 0;
        let score = 0;
        const passingScore = 80; // Percent

        // Initialize: Set Iframe Source
        window.addEventListener('DOMContentLoaded', () => {
            const iframe = document.getElementById('google-drive-embed');
            iframe.src = `https://drive.google.com/file/d/${videoID}/preview`;
        });

        // Transition from Video to Quiz
        function finishVideo() {
            document.getElementById('video-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'block';
            loadQuestion();
        }

        // Load current question
        function loadQuestion() {
            const qData = quizData[currentQuestionIndex];
            
            // Update Progress Bar
            const progressPercent = (currentQuestionIndex / quizData.length) * 100;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;

            // Set Text
            document.getElementById('question-text').innerText = `${currentQuestionIndex + 1}. ${qData.Question}`;

            // Create Buttons
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = ''; // Clear previous

            qData.Options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(index);
                optionsContainer.appendChild(btn);
            });
        }

        // Handle Answer Selection
        function handleAnswer(selectedIndex) {
            const correctIndex = quizData[currentQuestionIndex].CorrectAnswer;
            
            if(selectedIndex === correctIndex) {
                score++;
            }

            currentQuestionIndex++;

            if(currentQuestionIndex < quizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        // Show Final Results
        function showResults() {
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';

            const finalPercent = Math.round((score / quizData.length) * 100);
            
            document.getElementById('score-text').innerText = `${finalPercent}%`;
            
            if(finalPercent >= passingScore) {
                document.getElementById('result-header').innerText = "Congratulations!";
                document.getElementById('result-header').style.color = "var(--success-green)";
                document.getElementById('result-detail').innerText = "You have successfully passed the assessment.";
                document.getElementById('success-area').classList.remove('hidden');
            } else {
                document.getElementById('result-header').innerText = "Module Failed";
                document.getElementById('score-text').style.color = "var(--error-red)";
                document.getElementById('result-detail').innerText = `You need ${passingScore}% to pass. Please try again.`;
                document.getElementById('retry-area').classList.remove('hidden');
            }
        }

        /**
         * ------------------------------------------------------------------
         * CERTIFICATE GENERATION (UPDATED & FIXED)
         * ------------------------------------------------------------------
         */
        async function generateCertificate() {
            // 1. Get User Name
            const nameInput = document.getElementById('learner-name');
            const learnerName = nameInput.value.trim();

            // 2. Validation
            if (!learnerName) {
                alert("Please enter your full name to generate the certificate.");
                return;
            }

            // 3. Initialize jsPDF (Destructure ensures correct loading)
            const { jsPDF } = window.jspdf;
            
            // Create new PDF: Landscape, Millimeters, A4 size
            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: 'a4'
            });

            // --- CONFIGURATION ---
            const pageWidth = doc.internal.pageSize.getWidth(); // 297mm
            const pageHeight = doc.internal.pageSize.getHeight(); // 210mm
            const centerX = pageWidth / 2;
            
            // Colors
            const navyBlue = "#1F2A44";
            const p44Blue = "#00C0F3";
            const lightGray = "#7a7a7a";

            // --- DESIGNING THE CERTIFICATE ---

            // 1. Thick Navy Border
            doc.setDrawColor(navyBlue);
            doc.setLineWidth(3);
            doc.rect(5, 5, pageWidth - 10, pageHeight - 10);

            // 2. Inner Thin Border (Decorative)
            doc.setLineWidth(0.5);
            doc.rect(8, 8, pageWidth - 16, pageHeight - 16);

            // 3. Header: "Certificate of Completion"
            doc.setTextColor(navyBlue);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(32);
            doc.text("CERTIFICATE OF COMPLETION", centerX, 50, { align: "center" });

            // 4. Sub-Header: "This certifies that"
            doc.setFont("helvetica", "normal");
            doc.setFontSize(16);
            doc.setTextColor(lightGray);
            doc.text("This certifies that", centerX, 75, { align: "center" });

            // 5. User Name (Dynamic)
            doc.setFont("helvetica", "bold");
            doc.setFontSize(40);
            doc.setTextColor(p44Blue); // Project44 Cyan/Blue
            doc.text(learnerName, centerX, 100, { align: "center" });

            // Line under name
            doc.setDrawColor(lightGray);
            doc.setLineWidth(0.5);
            doc.line(centerX - 60, 105, centerX + 60, 105);

            // 6. Course Title
            doc.setFont("helvetica", "normal");
            doc.setFontSize(16);
            doc.setTextColor(lightGray);
            doc.text("has successfully passed the verified assessment for", centerX, 125, { align: "center" });

            doc.setFont("helvetica", "bold");
            doc.setFontSize(22);
            doc.setTextColor(navyBlue);
            doc.text("Project44 Product Training", centerX, 140, { align: "center" });

            // 7. Footer Info (Date & Score)
            const today = new Date().toLocaleDateString();
            const finalScore = Math.round((score / quizData.length) * 100); 

            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.setTextColor(navyBlue);

            // Date (Bottom Left)
            doc.text(`Date Issued: ${today}`, 20, 185);

            // Score (Bottom Right)
            doc.text(`Final Score: ${finalScore}%`, pageWidth - 20, 185, { align: "right" });

            // Footer Tagline (Center Bottom)
            doc.setFontSize(10);
            doc.setTextColor(lightGray);
            doc.text("Verified Training Module", centerX, 195, { align: "center" });

            // --- SAVE FILE ---
            doc.save("Project44_Training_Certificate.pdf");
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project44 Product Training Module</title>
    <!-- jsPDF Library for Certificate Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root {
            /* Project44 Inspired Palette */
            --p44-navy: #1F2A44;      /* Deep Navy */
            --p44-blue: #00C0F3;      /* Cyan/Teal Accent */
            --text-color: #333333;
            --bg-color: #f4f7f6;
            --white: #ffffff;
            --success-green: #28a745;
            --error-red: #dc3545;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        header {
            background-color: var(--p44-navy);
            color: var(--white);
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        header h1 {
            font-weight: 600;
            letter-spacing: 0.5px;
            font-size: 1.5rem;
        }

        /* --- Main Container --- */
        .container {
            max-width: 800px;
            width: 95%;
            margin: 2rem auto;
            background: var(--white);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(31, 42, 68, 0.1);
            padding: 2rem;
            flex: 1;
        }

        /* --- Video Section (Iframe Embed) --- */
        .video-section {
            display: block; /* Visible by default */
        }

        /* 16:9 Aspect Ratio Container for Iframe */
        .iframe-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .iframe-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        .instruction-text {
            text-align: center;
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        /* --- Buttons --- */
        .btn {
            background-color: var(--p44-blue);
            color: var(--white);
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s ease;
            display: block;
            margin: 0 auto;
        }

        .btn:hover {
            background-color: #009ac2;
        }

        /* --- Quiz Section --- */
        .quiz-section {
            display: none; /* Hidden by default */
        }

        .progress-bar-container {
            width: 100%;
            background-color: #e9ecef;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--p44-navy);
            width: 0%;
            transition: width 0.3s ease;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--p44-navy);
            margin-bottom: 1.5rem;
        }

        .options-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background-color: var(--white);
            border: 2px solid #e0e0e0;
            padding: 15px;
            text-align: left;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease;
            color: var(--text-color);
        }

        .option-btn:hover {
            border-color: var(--p44-blue);
            background-color: #f0fbff;
        }

        /* --- Result Section --- */
        .result-section {
            display: none;
            text-align: center;
            padding: 1rem;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--p44-navy);
            margin-bottom: 1rem;
        }

        .result-message {
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }

        /* --- Certificate Form --- */
        .certificate-form {
            max-width: 400px;
            margin: 0 auto;
            text-align: left;
            background: #f9f9f9;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #eee;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--p44-navy);
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
        }

        .hidden {
            display: none !important;
        }

        /* Mobile Adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
                margin: 1rem auto;
            }
            header h1 {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Logistics & Visibility Fundamentals</h1>
    </header>

    <div class="container">
        
        <!-- SECTION 1: VIDEO PLAYER -->
        <div id="video-section" class="video-section">
            <h2 style="color: var(--p44-navy); margin-bottom: 1rem;">Step 1: Training Video</h2>
            
            <div class="iframe-container">
                <!-- 
                    The src is set dynamically by JavaScript below 
                    using the videoID variable.
                -->
                <iframe id="google-drive-embed" allow="autoplay; fullscreen" allowfullscreen></iframe>
            </div>

            <p class="instruction-text">
                Please proceed after watching the video above. <br>
                
            </p>

            <button class="btn" onclick="finishVideo()">I have finished watching the video</button>
        </div>

        <!-- SECTION 2: QUIZ -->
        <div id="quiz-section" class="quiz-section">
            <div class="progress-bar-container">
                <div id="progress-fill" class="progress-bar-fill"></div>
            </div>
            
            <div id="quiz-container">
                <div id="question-text" class="question-text"></div>
                <div id="options-container" class="options-list"></div>
            </div>
        </div>

        <!-- SECTION 3: RESULTS & CERTIFICATE -->
        <div id="result-section" class="result-section">
            <div id="score-text" class="score-display">0%</div>
            <h2 id="result-header" style="color: var(--p44-navy);">Completed</h2>
            <p id="result-detail" class="result-message"></p>

            <!-- Success Area: Certificate Input -->
            <div id="success-area" class="hidden">
                <div class="certificate-form">
                    <div class="form-group">
                        <label for="learner-name">Enter Full Name for Certificate:</label>
                        <input type="text" id="learner-name" class="form-control" placeholder="e.g. Jane Doe">
                    </div>
                    <button class="btn" onclick="generateCertificate()">Download Certificate</button>
                </div>
            </div>

            <!-- Retry Area -->
            <div id="retry-area" class="hidden">
                <button class="btn" style="background-color: var(--p44-navy);" onclick="location.reload()">Retry Module</button>
            </div>
        </div>

    </div>

    <script>
        /**
         * ------------------------------------------------------------------
         * CONFIGURATION
         * ------------------------------------------------------------------
         */
        // 1. Paste your Google Drive Video File ID here:
        const videoID = "1kZ1uNSwoQ7_ha4n27RIOwVUSGB5iOblA";

        // 2. Quiz Data
        const quizData = [ 
            { "Question": "According to the sources, what is the legal role of a Freight Forwarder (FFW) in its purest definition?", "Options": [ "Carrier", "Agent", "Vessel Operator", "Consignee" ], "CorrectAnswer": 1 }, 
            { "Question": "Which primary document does an NVOCC issue to the actual shipper to act as a binding contract of carriage?", "Options": [ "Forwarder's Certificate of Receipt (FCR)", "Master Bill of Lading (MBL)", "House Bill of Lading (HBL)", "Shipper's Letter of Instruction (SLI)" ], "CorrectAnswer": 2 }, 
            { "Question": "What type of liability is typically associated with a Freight Forwarder acting as an agent?", "Options": [ "Full Carrier Liability", "Limited Agency Liability (Errors & Omissions)", "Strict Liability for Cargo Damage", "No Liability" ], "CorrectAnswer": 1 }, 
            { "Question": "Which EDI message code is known as the 'heartbeat' of ocean visibility, providing granular status details for major milestones?", "Options": [ "EDI 300", "EDI 301", "EDI 304", "EDI 315" ], "CorrectAnswer": 3 }, 
            { "Question": "Under the US Customs '10+2' rule, when must the Importer Security Filing (ISF) be submitted?", "Options": [ "24 hours after the vessel departs", "24 hours prior to loading at the foreign port", "Upon arrival at the destination port", "48 hours after the container gates in" ], "CorrectAnswer": 1 }, 
            { "Question": "In the context of LCL consolidation, what must an NVOCC provide to link individual HBLs to a single container number in visibility platforms?", "Options": [ "Master Bill of Lading", "Vessel Schedule (EDI 323)", "Container Manifest or Stuffing Report", "Freight Invoice (EDI 310)" ], "CorrectAnswer": 2 }, 
            { "Question": "What is a 'Street Turn' in physical logistics?", "Options": [ "A trucker reusing an empty container for a new export without returning it to the terminal", "A vessel changing course due to weather", "Returning a full container to the wrong terminal gate", "The process of weighing a container on a weighbridge" ], "CorrectAnswer": 0 }, 
            { "Question": "Which EDI 315 segment contains the specific event code, date, and time (e.g., VD for Vessel Departure)?", "Options": [ "B4", "N9", "Q2", "R4" ], "CorrectAnswer": 0 }, 
            { "Question": "What are the two data elements that the carrier must file under the US Customs '10+2' rule?", "Options": [ "Seller Name and Buyer Name", "Container Status Messages and Stow Plan", "Country of Origin and HTS-6 Code", "Manufacturer and Ship to Party" ], "CorrectAnswer": 1 }, 
            { "Question": "Which status code in the B4 segment of an EDI 315 message signifies that a container has been loaded on a vessel?", "Options": [ "OA", "VA", "AE", "UV" ], "CorrectAnswer": 2 } 
        ];

        /**
         * ------------------------------------------------------------------
         * APP LOGIC
         * ------------------------------------------------------------------
         */
        
        let currentQuestionIndex = 0;
        let score = 0;
        const passingScore = 80; // Percent

        // Initialize: Set Iframe Source
        window.addEventListener('DOMContentLoaded', () => {
            const iframe = document.getElementById('google-drive-embed');
            iframe.src = `https://drive.google.com/file/d/${videoID}/preview`;
        });

        // Transition from Video to Quiz
        function finishVideo() {
            document.getElementById('video-section').style.display = 'none';
            document.getElementById('quiz-section').style.display = 'block';
            loadQuestion();
        }

        // Load current question
        function loadQuestion() {
            const qData = quizData[currentQuestionIndex];
            
            // Update Progress Bar
            const progressPercent = (currentQuestionIndex / quizData.length) * 100;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;

            // Set Text
            document.getElementById('question-text').innerText = `${currentQuestionIndex + 1}. ${qData.Question}`;

            // Create Buttons
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = ''; // Clear previous

            qData.Options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = () => handleAnswer(index);
                optionsContainer.appendChild(btn);
            });
        }

        // Handle Answer Selection
        function handleAnswer(selectedIndex) {
            const correctIndex = quizData[currentQuestionIndex].CorrectAnswer;
            
            if(selectedIndex === correctIndex) {
                score++;
            }

            currentQuestionIndex++;

            if(currentQuestionIndex < quizData.length) {
                loadQuestion();
            } else {
                showResults();
            }
        }

        // Show Final Results
        function showResults() {
            document.getElementById('quiz-section').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';

            const finalPercent = Math.round((score / quizData.length) * 100);
            
            document.getElementById('score-text').innerText = `${finalPercent}%`;
            
            if(finalPercent >= passingScore) {
                document.getElementById('result-header').innerText = "Congratulations!";
                document.getElementById('result-header').style.color = "var(--success-green)";
                document.getElementById('result-detail').innerText = "You have successfully passed the assessment.";
                document.getElementById('success-area').classList.remove('hidden');
            } else {
                document.getElementById('result-header').innerText = "Module Failed";
                document.getElementById('score-text').style.color = "var(--error-red)";
                document.getElementById('result-detail').innerText = `You need ${passingScore}% to pass. Please try again.`;
                document.getElementById('retry-area').classList.remove('hidden');
            }
        }

        // Generate PDF Certificate (Client-Side)
        async function generateCertificate() {
            const nameInput = document.getElementById('learner-name');
            const name = nameInput.value.trim();

            if(!name) {
                alert("Please enter your name.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: 'a4'
            });

            // --- Certificate Design ---
            
            // 1. Border
            doc.setLineWidth(2);
            doc.setDrawColor(31, 42, 68); // Navy
            doc.rect(10, 10, 277, 190);

            // 2. Header Block
            doc.setFillColor(31, 42, 68); // Navy
            doc.rect(10, 10, 277, 40, 'F');
            
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(26);
            doc.setFont("helvetica", "bold");
            doc.text("CERTIFICATE OF COMPLETION", 148.5, 30, { align: "center" });

            // 3. Body Text
            doc.setTextColor(31, 42, 68);
            doc.setFontSize(16);
            doc.setFont("helvetica", "normal");
            doc.text("This certifies that", 148.5, 75, { align: "center" });

            // 4. Name
            doc.setFontSize(32);
            doc.setTextColor(0, 192, 243); // P44 Blue
            doc.setFont("helvetica", "bold");
            doc.text(name, 148.5, 95, { align: "center" });
            
            // Underline
            doc.setDrawColor(200, 200, 200);
            doc.setLineWidth(0.5);
            doc.line(70, 100, 227, 100);

            // 5. Course Title
            doc.setTextColor(31, 42, 68);
            doc.setFontSize(16);
            doc.setFont("helvetica", "normal");
            doc.text("has successfully completed the training module:", 148.5, 120, { align: "center" });

            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("Project44 Product Training", 148.5, 135, { align: "center" });

            // 6. Footer (Date and Score)
            const today = new Date().toLocaleDateString();
            const finalPercent = Math.round((score / quizData.length) * 100);

            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text(`Date: ${today}`, 20, 185);
            doc.text(`Score: ${finalPercent}%`, 277, 185, { align: "right" });

            // Trigger Download
            doc.save("Project44_Certificate.pdf");
        }
    </script>
</body>
</html>
